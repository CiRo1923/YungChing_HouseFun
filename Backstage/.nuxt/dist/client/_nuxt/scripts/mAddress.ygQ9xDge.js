import{_ as ae}from"./Select.CEBHKyyN.js";import{_ as M}from"./Input.CIvvOtSQ.js";import{k as ye,L as he,h as be,o as d,c as C,a as w,a5 as _,b as R,w as D,a8 as we,af as Ce,ag as Ve,a7 as oe,a4 as b,x as l,E,t as ne,F as j,G as $e,B as ke,d as U,ah as _e,ai as Ne,m as x,r as h,q,a9 as k}from"./entry.BKKcR4L7.js";import{a as Ee,_ as Re,E as Ae}from"./mForm.css.DDVQRDHv.js";import{d as Se}from"./_prototype.6FgksIwr.js";const De=["name","placeholder","disabled"],Fe=["onClick"],Ie={class:"m-autocomplete-dropdown-label relative block grow py-[8px] text-[14px]"},Le={__name:"mAutoComplete",props:{name:{type:String,default:""},modelValue:{type:[String,Number,Boolean],default:null},options:{type:Array,default:()=>[]},config:{type:Object,default:()=>{}},rules:{type:[String,Object],default:null},setClass:{type:Object,default:()=>{}}},emits:["change","search","update:modelValue"],setup(z,{emit:W}){const v=W,e=z,V=h(null),N=h(null),F=h(null),I=h(null),$=h(null),A=h(!1),S=h(!1),L=h(!1),p=h(null),y=h({index:null}),m=h(null),g=x({get(){return e.modelValue},set(a){v("update:modelValue",a)}}),s=x(()=>Se({placeholder:"",noMatchClearLabel:!0,noResult:"無任何選項。",isDisabled:!1,isExistClose:!0,isError:!1,position:"auto",schema:{label:"label",value:"value"},keyboard:!1,maxItems:5},e.config)),o=x(()=>({main:"",container:"",element:"",type:"",error:"",dropdown:"",dropdownContainer:"",...e.setClass})),t=()=>{const{schema:a}=s.value,{label:i}=a,r=()=>p.value.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),u=p.value?new RegExp(r()):null,c=u?e.options.filter(f=>u.test(f[i])):e.options;m.value=c},n=a=>{S.value=a!==void 0?a:!S.value,A.value=a!==void 0?a:!A.value},se=()=>{n(!1)},P=()=>{const i=g.value!==null&&g.value!==""?e.options.find(r=>r[s.value.schema.value]===g.value):null;p.value=i?i[s.value.schema.label]:""},re=()=>{m.value=e.options.length!==0?e.options:null},J=a=>{L.value=a},ue=async()=>{re(),n(!0),await q(),B()},ie=async()=>{L.value||(t(),await q(),B())},de=async()=>{J(!1),t(),await q(),B()},me=()=>{const{noMatchClearLabel:a}=s.value,i=p.value?!!e.options.find(c=>c[s.value.schema.label]===p.value):!1,r=e.options.find(c=>c[s.value.schema.value]===g.value),u=g.value&&r?r[s.value.schema.label]:"";a&&!i&&(p.value=u)},B=()=>{const{maxItems:a,isDisabled:i}=s.value,r=V.value,u=N.value,c=I.value,f={rect:V.value.getBoundingClientRect()},X=f.rect.height+f.rect.top+window.scrollY;if(r&&u)if(c){const H=$.value.length>a;H&&(c.style.overflowY="auto");const fe=H?a-1:$.value.length-1,O=$.value[fe],T={rect:N.value.getBoundingClientRect()},ve=O?H?O.offsetTop:O.offsetTop+O.offsetHeight:0,Z=T.rect.width+f.rect.left,ge=T.rect.width<f.rect.width?f.rect.width:T.rect.width,ee=f.rect.width+f.rect.left-ge,te=document.body.scrollWidth,xe=(Z>te&&ee<0||Z<te)&&s.value.position!=="right"?f.rect.left:ee,le=ve;if(u.style.height=`${le}px`,u.style.top=`${X}px`,u.style.left=`${xe}px`,T.rect.width<f.rect.width&&(u.style.minWidth=`${f.rect.width}px`),g.value!==null&&g.value!==""){y.value.index=e.options.findIndex(Y=>Y[s.value.schema.value]===g.value);const G=$.value[y.value.index];if(G){const Y={rect:G.getBoundingClientRect()};c.scrollTop=G.offsetTop+Y.rect.height/2-le/2}}}else i||(u.style.height=`${F.value.offsetHeight}px`,u.style.top=`${X}px`,u.style.left=`${f.rect.left}px`,u.style.minWidth=`${f.rect.width}px`)},pe=a=>{g.value=a[s.value.schema.value],p.value=a[s.value.schema.label],n(!1),v("change",a)},ce=()=>{g.value="",p.value=null,y.value.index=null};ye(()=>e.modelValue,a=>{P()});const K=a=>{const i=V.value,r=N.value,u=i?!i.contains(a.target):!0,c=r?!r.contains(a.target):!0;u&&c&&n(!1)},Q=()=>{B()};return he(()=>{P(),t(),document.addEventListener("click",K,!0),window.addEventListener("resize",Q)}),be(()=>{document.removeEventListener("click",K,!0),window.removeEventListener("resize",Q)}),(a,i)=>(d(),C(j,null,[w("div",{class:_(["m-autocomplete",o.value.main])},[w("div",{class:_(["m-autocomplete-container overflow-hidden",o.value.container])},[R(l(Ee),{name:e.name,rules:e.rules,modelValue:g.value,"onUpdate:modelValue":i[2]||(i[2]=r=>g.value=r)},{default:D(({field:r,errorMessage:u})=>[w("input",we({type:"hidden"},r),null,16),w("div",{class:_(["m-autocomplete-element jFormValid relative flex items-center gap-x-[8px] rounded-[5px] border-[1px] border-[--autocomplete-border-color] bg-[--autocomplete-bg-color] px-[10px] transition-colors duration-300",[o.value.element,{"--focus":S.value},{"--disabled":s.value.isDisabled},{"--error":u||s.value.isError}]]),ref_key:"elenemtRef",ref:V},[Ce(w("input",{name:`${e.name}_type`,type:"text","onUpdate:modelValue":i[0]||(i[0]=c=>p.value=c),class:"m-autocomplete-type min-w-0 grow",autocomplete:"off",placeholder:s.value.placeholder,disabled:s.value.isDisabled,onFocus:ue,onInput:ie,onBlur:me,onCompositionstart:i[1]||(i[1]=c=>J(!0)),onCompositionend:de},null,40,De),[[Ve,p.value]]),s.value.isExistClose&&!s.value.isDisabled?(d(),C("button",{key:0,type:"button",class:_(["m-autocomplete-clear-button flex h-[18px] w-[18px] shrink-0 items-center p-[4px] text-[--gray-999] transition-opacitys duration-300",{"--show":p.value}]),onClick:ce},[R(oe,{icon:"icon_xmark",class:"m-autocomplete-clear-icon"})],2)):b("",!0),R(oe,{icon:"icon_search",class:"pointer-events-none h-[18px] w-[18px] shrink-0 text-[--autocomplete-icon-color] transition-colors duration-300"})],2)]),_:1},8,["name","rules","modelValue"])],2),R(l(Ae),{as:"span",class:_(["m-autocomplete-error",o.value.error]),name:e.name},{default:D(({message:r})=>[R(Re,{message:r},null,8,["message"])]),_:1},8,["class","name"])],2),(d(),E(Ne,{to:"body"},[R(_e,{name:"autocomplete",onAfterLeave:se,appear:""},{default:D(()=>[A.value&&m.value&&!s.value.isDisabled?(d(),C("div",{key:0,class:_(["m-autocomplete-dropdown absolute z-[5] mt-[3px] overflow-hidden",o.value.dropdown]),ref_key:"dropdownRef",ref:N},[m.value.length===0?(d(),C("div",{key:0,class:"m-autocomplete-dropdown-no-data bg-[--white] p-[8px] text-[14px] text-[--gray-333]",ref_key:"dropdownNoDataRef",ref:F},[w("p",null,ne(s.value.noResult),1)],512)):(d(),C("ul",{key:1,class:_(["m-autocomplete-dropdown-container max-h-full bg-[--white]",o.value.dropdownContainer]),ref_key:"dropdownContainerRef",ref:I},[(d(!0),C(j,null,$e(m.value,(r,u)=>(d(),C("li",{class:"m-autocomplete-dropdown-item",key:`${r}_${u}`,ref_for:!0,ref_key:"dropdownItemRef",ref:$},[w("button",{type:"button",class:_(["m-autocomplete-dropdown-button block w-full px-[8px] text-left transition-colors duration-300",{"--active":u===y.value.index}]),onClick:c=>pe(r)},[w("em",Ie,[ke(a.$slots,"option",{item:r},()=>[U(ne(r[s.value.schema.label]),1)])])],10,Fe)]))),128))],2))],2)):b("",!0)]),_:3})]))],64))}},je={__name:"mAddress",props:{name:{type:String,default:""},city:{type:[String,Number],default:null},area:{type:[String,Number],default:null},road:{type:[String,Number],default:null},lane:{type:[String,Number],default:null},alley:{type:[String,Number],default:null},number:{type:[String,Number],default:null},ofNumber:{type:[String,Number],default:null},floor:{type:[String,Number],default:null},ofFloor:{type:[String,Number],default:null},config:{type:Object,default:()=>({})},setClass:{type:Object,default:()=>({})}},emits:["update:city","update:area","update:road","update:lane","update:alley","update:number","update:ofNumber","update:floor","update:ofFloor","change:city","change:area"],setup(z,{emit:W}){const v=W,e=z,V=x({get(){return e.city},set(o){v("update:city",o)}}),N=x({get(){return e.area},set(o){v("update:area",o)}}),F=x({get(){return e.road},set(o){v("update:road",o)}}),I=x({get(){return e.lane},set(o){v("update:lane",o)}}),$=x({get(){return e.alley},set(o){v("update:alley",o)}}),A=x({get(){return e.number},set(o){v("update:number",o)}}),S=x({get(){return e.ofNumber},set(o){v("update:ofNumber",o)}}),L=x({get(){return e.floor},set(o){v("update:floor",o)}}),p=x({get(){return e.ofFloor},set(o){v("update:ofFloor",o)}}),y=x(()=>({city:{options:null,schema:{label:"label",value:"value"}},area:{options:null,schema:{label:"label",value:"value"}},road:{options:null,schema:{label:"label",value:"value"}},...e.config})),m=x(()=>({main:"",city:"",area:"",...e.setClass})),g=()=>{v("change:city")},s=()=>{v("change:area")};return(o,t)=>(d(),C("div",{class:_(["m-address flex flex-wrap gap-x-[8px] m:gap-y-[12px] pt:gap-y-[8px]",l(m).main])},[e.city!==null?(d(),E(ae,{key:0,name:`${e.name}_address_city`,modelValue:l(V),"onUpdate:modelValue":t[0]||(t[0]=n=>k(V)?V.value=n:null),options:l(y).city.options,config:{placeholder:"選擇縣市",schema:l(y).city.schema},setClass:{main:["--height-40 --px-12 --py-8 m:w-full",l(m).city]},onChange:t[1]||(t[1]=n=>g())},null,8,["name","modelValue","options","config","setClass"])):b("",!0),e.area!==null?(d(),E(ae,{key:1,name:`${e.name}_address_area`,modelValue:l(N),"onUpdate:modelValue":t[2]||(t[2]=n=>k(N)?N.value=n:null),options:l(y).area.options,config:{placeholder:"選擇區域",schema:l(y).area.schema,isDisabled:!l(V)},setClass:{main:["--height-40 --px-12 --py-8 m:w-full",l(m).area]},onChange:t[3]||(t[3]=n=>s())},null,8,["name","modelValue","options","config","setClass"])):b("",!0),e.road!==null?(d(),E(Le,{key:2,name:`${e.name}_address_road`,modelValue:l(F),"onUpdate:modelValue":t[4]||(t[4]=n=>k(F)?F.value=n:null),options:l(y).road.options,config:{placeholder:"請選擇路段",schema:l(y).road.schema,noMatchClearLabel:!1},setClass:{main:["--height-40 --px-12 --py-8 m:w-full",l(m).road]}},null,8,["name","modelValue","options","config","setClass"])):b("",!0),e.lane!==null?(d(),E(M,{key:3,name:`${e.name}_address_lane`,modelValue:l(I),"onUpdate:modelValue":t[5]||(t[5]=n=>k(I)?I.value=n:null),config:{isExistClose:!1},setClass:{main:["--height-40 --px-12 --py-8",l(m).lane],rearAssist:"text-[14px] text-[--gray-999]"}},{rearAssist:D(()=>[...t[11]||(t[11]=[U("巷",-1)])]),_:1},8,["name","modelValue","setClass"])):b("",!0),e.alley!==null?(d(),E(M,{key:4,name:`${e.name}_address_alley`,modelValue:l($),"onUpdate:modelValue":t[6]||(t[6]=n=>k($)?$.value=n:null),config:{isExistClose:!1},setClass:{main:["--height-40 --px-12 --py-8",l(m).alley],rearAssist:"text-[14px] text-[--gray-999]"}},{rearAssist:D(()=>[...t[12]||(t[12]=[U("弄",-1)])]),_:1},8,["name","modelValue","setClass"])):b("",!0),e.number!==null?(d(),E(M,{key:5,name:`${e.name}_address_number`,modelValue:l(A),"onUpdate:modelValue":t[7]||(t[7]=n=>k(A)?A.value=n:null),config:{isExistClose:!1},setClass:{main:["--height-40 --px-12 --py-8",l(m).number],rearAssist:"text-[14px] text-[--gray-999]"}},{rearAssist:D(()=>[...t[13]||(t[13]=[U("號",-1)])]),_:1},8,["name","modelValue","setClass"])):b("",!0),e.ofNumber!==null?(d(),C(j,{key:6},[t[14]||(t[14]=w("span",{class:"h-40px flex items-center text-[16px] text-[--gray-666]"},"之",-1)),R(M,{name:`${e.name}_address_of_number`,modelValue:l(S),"onUpdate:modelValue":t[8]||(t[8]=n=>k(S)?S.value=n:null),config:{isExistClose:!1},setClass:{main:["--height-40 --px-12 --py-8",l(m).ofNumber],rearAssist:"text-[14px] text-[--gray-999]"}},null,8,["name","modelValue","setClass"])],64)):b("",!0),e.floor!==null?(d(),E(M,{key:7,name:`${e.name}_address_floor`,modelValue:l(L),"onUpdate:modelValue":t[9]||(t[9]=n=>k(L)?L.value=n:null),config:{isExistClose:!1},setClass:{main:["--height-40 --px-12 --py-8",l(m).floor],rearAssist:"text-[14px] text-[--gray-999]"}},{rearAssist:D(()=>[...t[15]||(t[15]=[U("樓",-1)])]),_:1},8,["name","modelValue","setClass"])):b("",!0),e.ofFloor!==null?(d(),C(j,{key:8},[t[16]||(t[16]=w("span",{class:"h-40px flex items-center text-[16px] text-[--gray-666]"},"之",-1)),R(M,{name:`${e.name}_address_of_floor`,modelValue:l(p),"onUpdate:modelValue":t[10]||(t[10]=n=>k(p)?p.value=n:null),config:{isExistClose:!1},setClass:{main:["--height-40 --px-12 --py-8",l(m).ofFloor],rearAssist:"text-[14px] text-[--gray-999]"}},null,8,["name","modelValue","setClass"])],64)):b("",!0)],2))}};export{je as _};
