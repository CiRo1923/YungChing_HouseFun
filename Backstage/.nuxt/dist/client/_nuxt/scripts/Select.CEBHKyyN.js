import{k as J,L as pe,h as me,o as c,c as m,a as h,b as R,w as V,a8 as he,a5 as i,ae as L,F as D,d as j,t as A,a4 as x,E as Q,a7 as we,B as X,x as Z,G as ge,ah as ye,ai as be,m as k,q as xe,r as d}from"./entry.BKKcR4L7.js";import{a as ke,_ as Ce,E as Te}from"./mForm.css.DDVQRDHv.js";import{b as ee,e as _e,o as $e,d as Re}from"./_prototype.6FgksIwr.js";import"./_validation.4s3DImk1.js";const De=["id"],Ie=["disabled"],Oe={key:1,class:"m-form-icon-arrow h-[16px] w-[16px] shrink-0"},Ee=["disabled","onClick"],Be={class:"m-select-dropdown-label relative block grow py-[8px] text-[14px]"},M=0,Ae={__name:"Select",props:{name:{type:String,default:null},modelValue:{type:[String,Number,Boolean,Object],default:null},options:{type:[Array,Object],default:null},config:{type:Object,default:()=>{}},rules:{type:Object,default:null},setClass:{type:Object,default:()=>{}}},emits:["update:modelValue","change"],setup(te,{emit:le}){const z=le,v=te,C=d(null),N=d(null),g=d(null),W=d(null),w=d(null),oe=d(null),I=d(!1),O=d(!1),n=d(-1),y=d(null),u=k({get(){return v.modelValue},set(t){z("update:modelValue",t)}}),a=k(()=>Re({arrowType:"caret",startOption:null,placeholder:null,isDisabled:!1,isError:!1,position:"auto",schema:{label:"label",value:"value"},keyboard:!1,maxItems:5},v.config)),f=k(()=>({main:"",container:"",element:"",type:"",suffix:"",error:"",dropdown:"",dropdownContainer:"",...v.setClass})),E=k(()=>{const{placeholder:t}=a.value;return t&&typeof t!="string"?t:{value:t,isToOption:!1}}),r=k(()=>{const{schema:t}=a.value,{value:l,isToOption:e}=E.value,s=v.options?ee(v.options):[],o=_e(ee(s[0]));return e&&(o[t.label]=l,o[t.value]="",s.unshift(o)),s}),B=()=>{const{startOption:t}=a.value;let l=-1;r.value&&(t?l=r.value.findIndex(e=>e.value===t):l=r.value.findIndex(e=>e[a.value.schema.value]===u.value),y.value=l!==-1?r.value[l][a.value.schema.label]:null),n.value=l},b=t=>{I.value=t!==void 0?t:!I.value,O.value=t!==void 0?t:!O.value},ae=()=>{b(!1)},ne=async()=>{b(),await xe(),F()},F=()=>{const{maxItems:t}=a.value,l=C.value,e=g.value,s=W.value,o={rect:C.value.getBoundingClientRect()};if(l&&e&&s){const p=t<=w.value.length-1;p&&(s.style.overflowY="auto");const T=p?t:w.value.length-1,_=w.value?w.value[T]:null,$={rect:g.value.getBoundingClientRect()},ue=_?p?_.offsetTop:_.offsetTop+_.offsetHeight:0,ce=o.rect.height+o.rect.top+window.scrollY,U=$.rect.width+o.rect.left,ie=$.rect.width<o.rect.width?o.rect.width:$.rect.width,Y=o.rect.width+o.rect.left-ie,q=document.body.scrollWidth,de=(U>q&&Y<0||U<q)&&a.value.position!=="right"?o.rect.left:Y,G=ue+M;if(e.style.height=`${G}px`,e.style.top=`${ce-M*2}px`,e.style.left=`${de-M}px`,$.rect.width<o.rect.width&&(e.style.minWidth=`${o.rect.width}px`),u.value!==null&&u.value!==""){n.value=r.value.findIndex(fe=>fe[a.value.schema.value]===u.value);const P=w.value[n.value],ve={rect:P.getBoundingClientRect()};s.scrollTop=P.offsetTop+ve.rect.height/2-G/2}}},H=t=>{const{code:l}=t;if(t.preventDefault(),a.value.keyboard&&r.value.length>0){n.value=l==="ArrowDown"?++n.value:--n.value,n.value>=r.value.length?n.value=n.value%r.value.length:n.value<0&&(n.value=r.value.length-1);const e=g.value,s=w.value[n.value],o={rect:g.value.getBoundingClientRect()},p={rect:s.getBoundingClientRect()};n.value!==0&&n.value!==r.value.length-1?l==="ArrowDown"?e.scrollTop+o.rect.height<=s.offsetTop&&(e.scrollTop=e.scrollTop+p.rect.height):e.scrollTop>s.offsetTop&&(e.scrollTop=e.scrollTop-p.rect.height):n.value===0?e.scrollTop=0:e.scrollTop=(r.value.length-a.value.maxItems)*p.rect.height;const T=r.value[n.value];u.value=T[a.value.schema.value],y.value=T[a.value.schema.label]}},se=()=>{const t=N.value;b(!1),t.blur()},re=t=>{const{schema:l}=a.value,e=r.value[t];n.value=t,u.value=e[l.value],y.value=e[l.label],b(!1),z("change",e)},K=t=>{const l=C.value,e=g.value,s=l?!l.contains(t.target):!0,o=e?!e.contains(t.target):!0;s&&o&&b(!1)},S=()=>{oe.value=$e(),F()};return J(()=>u.value,()=>{B()}),J(()=>r.value,()=>{B()},{deep:!0}),pe(()=>{B(),S(),document.addEventListener("click",K,!0),window.addEventListener("resize",S)}),me(()=>{document.removeEventListener("click",K,!0),window.removeEventListener("resize",S)}),(t,l)=>(c(),m(D,null,[h("div",{class:i(["m-form",f.value.main])},[R(Z(ke),{name:v.name,modelValue:u.value,"onUpdate:modelValue":l[3]||(l[3]=e=>u.value=e),rules:a.value.isDisabled?"":v.rules},{default:V(({field:e,errorMessage:s})=>[h("input",he({type:"hidden",id:v.name},e),null,16,De),h("div",{class:i(["m-form-container flex",f.value.container])},[h("button",{type:"button",class:i(["m-form-element --select grow text-left",[f.value.element,{"--focus":I.value},{"--error":s||a.value.isError}]]),disabled:a.value.isDisabled,ref_key:"elenemtRef",ref:C,onClick:l[0]||(l[0]=o=>ne()),onKeydown:[l[1]||(l[1]=L(o=>H(o),["up"])),l[2]||(l[2]=L(o=>H(o),["down"]))],onKeypress:L(se,["enter"])},[h("div",{class:i(["m-form-type w-full cursor-pointer truncate",[f.value.type,{"--placeholder":!y.value||!u.value}]]),ref_key:"selectRef",ref:N},[y.value?(c(),m(D,{key:0},[j(A(r.value[n.value][a.value.schema.label]),1)],64)):!y.value&&E.value.value?(c(),m(D,{key:1},[j(A(E.value.value),1)],64)):x("",!0)],2),a.value.arrowType==="caret"?(c(),Q(we,{key:0,icon:"caret_large_down",class:i(["m-form-icon h-[14px] w-[14px] shrink-0 p-[2px] transition-transform duration-300",f.value.icon])},null,8,["class"])):x("",!0),a.value.arrowType==="arrow"?(c(),m("i",Oe)):x("",!0)],42,Ie),t.$slots.suffix?(c(),m("small",{key:0,class:i(["m-form-suffix",f.value.suffix])},[X(t.$slots,"suffix")],2)):x("",!0)],2)]),_:3},8,["name","modelValue","rules"]),R(Z(Te),{as:"span",name:v.name,class:i(["m-form-error",f.value.error])},{default:V(({message:e})=>[R(Ce,{message:e},null,8,["message"])]),_:1},8,["name","class"])],2),(c(),Q(be,{to:"body"},[R(ye,{name:"select-dropdown",onAfterLeave:ae,appear:""},{default:V(()=>[O.value&&r.value&&r.value.length!==0&&!a.value.isDisabled?(c(),m("div",{key:0,class:i(["m-select-dropdown absolute z-[5] mt-[3px] overflow-hidden",f.value.dropdown]),ref_key:"dropdownRef",ref:g},[h("ul",{class:i(["m-select-dropdown-container max-h-full bg-[--white]",f.value.dropdownContainer]),ref_key:"dropdownContainerRef",ref:W},[(c(!0),m(D,null,ge(r.value,(e,s)=>(c(),m("li",{class:"m-select-dropdown-item",key:`${e}_${s}`,ref_for:!0,ref_key:"dropdownItemRef",ref:w},[h("button",{type:"button",class:i(["m-select-dropdown-button block w-full px-[8px] text-left transition-colors duration-300",{"--active":s===n.value}]),disabled:e[a.value.schema.isDisabled]===!0,onClick:o=>re(s)},[h("em",Be,[X(t.$slots,"option",{item:e},()=>[j(A(e[a.value.schema.label]),1)])])],10,Ee)]))),128))],2)],2)):x("",!0)]),_:3})]))],64))}};export{Ae as _};
