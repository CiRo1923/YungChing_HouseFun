import{k as z,o as v,c as p,b as x,w as I,a as N,a5 as c,B as E,a4 as h,a8 as K,ae as q,a7 as P,t as U,x as D,m as C,r as F,q as G}from"./entry.BKKcR4L7.js";import{a as H,_ as J,E as Q}from"./mForm.css.DDVQRDHv.js";import{n as g,d as X}from"./_prototype.6FgksIwr.js";import"./_validation.4s3DImk1.js";const Y=["id","type","inputMode","minlength","maxlength","placeholder","readonly","disabled","onBlur"],ne={__name:"Input",props:{name:{type:String,default:null},type:{type:String,default:"text"},modelValue:{type:[String,Number],default:null},value:{type:[String,Number],default:null},rules:{type:Object,default:null},config:{type:Object,default:()=>{}},setClass:{type:Object,default:()=>{}}},emits:["update:modelValue","focusin","blur","input","keydown.enter"],setup(L,{emit:R}){const d=R,u=L,a=F(null),w=F(!1),l=C(()=>X({placeholder:"",length:null,minlength:null,maxlength:null,formatLength:null,isReadonly:!1,isDisabled:!1,isError:!1,inputMode:null,isExistClose:!0,inputChinese:!0,comma:!1,checkNotIsZero:!1,integer:!1},u.config)),V=C(()=>l.value.inputMode==="numeric"),M=C(()=>{const{formatLength:e,maxlength:t}=l.value;return e&&t?e.replace(/\{\s*(length|maxlength)\s*\}/g,(o,r)=>r==="length"?a.value?String(a.value.length):0:String(t)):null}),m=C(()=>({main:"",container:"",element:"",type:"",formatLength:"",frontAssist:"",rearAssist:"",suffix:"",error:"",...u.setClass})),Z=e=>{const{inputMode:t}=l.value,o=!u.modelValue&&u.value?{value:u.value}:{},r=V.value?{inputmode:t}:{};return{...e,...o,...r}},_=async e=>{const t=e.target.value,{inputMode:o,checkNotIsZero:r,integer:n,inputChinese:y}=l.value,f={chinese:/[\u4e00-\u9fa5０-９Ａ-Ｚａ-ｚ～！＠＃＄％︿＆＊（）＿｜｛｝［］＜＞？／＊＼＋－]/g,number:n?/[^0-9]/g:/[^0-9.]/g},b=(/numeric/.test(o)||!y)&&f.chinese.test(t);if(await G(),V.value){const i=f.number.test(t)?t.replace(f.number,""):t;a.value=r&&n&&/^0/.test(i)||r&&/^0\d/.test(i)?i.replace(/^0+/,""):i}else b&&(a.value=t.replace(f.chinese,""));d("input",e)},j=e=>{e.preventDefault(),d("keydown.enter")},S=(e,t)=>{const{comma:o,checkNotIsZero:r}=l.value,{type:n}=e,y=!!t,f=n==="focusin",b=n==="blur",i=o&&(a.value!==""||a.value!=null);if((f||b)&&(w.value=!w.value),f&&i&&(a.value=g.remove(a.value,!1)),b){let $=a.value;const k=i?g.remove($,!1):$;if(V.value){const{integer:A,checkNotIsZero:W}=l.value;let s=String(k??"").trim();if(s===""){d("update:modelValue",""),a.value=i?g.add("",!1):"",d(n,e,y);return}if(s==="."&&(s=""),A&&s.includes(".")&&(s=s.split(".")[0]),s&&(A?s=s.replace(/^0+/,""):s.startsWith("0.")||(s=s.replace(/^0+/,""),s.startsWith(".")&&(s="0"+s))),W){const B=Number(s);!(s===""||s==="0."||s===".")&&Number.isFinite(B)&&B===0&&(s=""),/^0\.$/.test(s)&&(s="")}d("update:modelValue",s),a.value=i?g.add(s,!1):s}else d("update:modelValue",k),a.value=i?g.add(k,!1):k}d(n,e,y)},O=e=>{const{comma:t}=l.value,o=t&&e!==""&&e!=null;a.value=o?g.add(e,!1):e},T=()=>{a.value=null};return z(()=>u.modelValue,e=>{O(e)},{immediate:!0}),(e,t)=>(v(),p("div",{class:c(["m-form overflow-hidden",m.value.main])},[x(D(H),{name:u.name,type:u.type,modelValue:a.value,"onUpdate:modelValue":t[3]||(t[3]=o=>a.value=o),rules:l.value.isDisabled?"":u.rules},{default:I(({field:o,errorMessage:r})=>[N("div",{class:c(["m-form-container",m.value.container])},[N("div",{class:c(["m-form-element",[m.value.element,{"--focus":w.value},{"--readonly":l.value.isReadonly},{"--disabled":l.value.isDisabled},{"--error":r||l.value.isError}]])},[e.$slots.frontAssist?(v(),p("div",{key:0,class:c(["m-form-assist shrink-0",m.value.frontAssist])},[E(e.$slots,"frontAssist")],2)):h("",!0),N("input",K({id:u.name,type:u.type,class:["m-form-type min-w-0 grow",m.value.type]},Z(o),{inputMode:l.value.inputMode,minlength:l.value.minlength||l.value.length,maxlength:l.value.maxlength||l.value.length,placeholder:l.value.placeholder,readonly:l.value.isReadonly,disabled:l.value.isDisabled,autocomplete:"off",onFocusin:t[0]||(t[0]=n=>S(n)),onBlur:n=>S(n,r),onInput:t[1]||(t[1]=n=>_(n)),onKeydown:t[2]||(t[2]=q(n=>j(n),["enter"]))}),null,16,Y),l.value.isExistClose&&!l.value.isDisabled?(v(),p("button",{key:1,type:"button",class:c(["m-form-clear-button",{"--show":a.value}]),onClick:T},[x(P,{icon:"icon_xmark",class:"m-form-clear-icon"})],2)):h("",!0),M.value?(v(),p("span",{key:2,class:c(["m-form-length shrink-0",m.value.length])},U(M.value),3)):h("",!0),e.$slots.rearAssist?(v(),p("div",{key:3,class:c(["m-form-assist shrink-0",m.value.rearAssist])},[E(e.$slots,"rearAssist")],2)):h("",!0)],2),e.$slots.suffix?(v(),p("small",{key:0,class:c(["m-form-suffix shrink-0",m.value.suffix])},[E(e.$slots,"suffix",{maxlength:l.value.length||l.value.maxlength,length:a.value?a.value.length:0})],2)):h("",!0)],2)]),_:3},8,["name","type","modelValue","rules"]),x(D(Q),{as:"span",name:u.name,class:c(["m-form-error",m.value.error])},{default:I(({message:o})=>[x(J,{message:o},null,8,["message"])]),_:1},8,["name","class"])],2))}};export{ne as _};
