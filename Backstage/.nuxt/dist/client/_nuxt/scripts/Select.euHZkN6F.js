import{k as J,K as pe,h as me,o as u,c as m,a as w,b as R,w as B,a6 as we,H as c,aa as L,a3 as D,d as j,t as A,G as x,D as Q,a5 as he,F as X,x as Z,a4 as ge,ab as ye,ac as be,m as k,p as xe,r as i}from"./entry.DC204dd0.js";import{a as ke,_ as Ce,E as Te}from"./mForm.css.C05YFVEc.js";import{b as ee,e as _e,o as $e,d as Re}from"./_prototype.DQ_cqdh2.js";const De=["id"],Ie=["disabled"],Oe={key:1,class:"m-form-icon-arrow h-[16px] w-[16px] shrink-0"},Ee=["disabled","onClick"],Se={class:"m-select-dropdown-label relative block grow py-[8px] text-[14px]"},M=0,je={__name:"Select",props:{name:{type:String,default:null},modelValue:{type:[String,Number,Boolean,Object],default:null},options:{type:[Array,Object],default:null},config:{type:Object,default:()=>{}},rules:{type:Object,default:null},setClass:{type:Object,default:()=>{}}},emits:["update:modelValue","change"],setup(te,{emit:le}){const z=le,d=te,C=i(null),N=i(null),g=i(null),W=i(null),h=i(null),oe=i(null),I=i(!1),O=i(!1),a=i(-1),y=i(null),f=k({get(){return d.modelValue},set(t){z("update:modelValue",t)}}),n=k(()=>Re({arrowType:"caret",startOption:null,placeholder:null,isDisabled:!1,isError:!1,position:"auto",schema:{label:"label",value:"value"},keyboard:!1,maxItems:5},d.config)),v=k(()=>({main:"",container:"",element:"",type:"",suffix:"",error:"",dropdown:"",dropdownContainer:"",...d.setClass})),E=k(()=>{const{placeholder:t}=n.value;return t&&typeof t!="string"?t:{value:t,isToOption:!1}}),r=k(()=>{const{schema:t}=n.value,{value:l,isToOption:e}=E.value,s=d.options?ee(d.options):[],o=_e(ee(s[0]));return e&&(o[t.label]=l,o[t.value]="",s.unshift(o)),s}),S=()=>{const{startOption:t}=n.value;let l=-1;r.value&&(t?l=r.value.findIndex(e=>e.value===t):l=r.value.findIndex(e=>e[n.value.schema.value]===f.value),y.value=l!==-1?r.value[l][n.value.schema.label]:null),a.value=l},b=t=>{I.value=t!==void 0?t:!I.value,O.value=t!==void 0?t:!O.value},ne=()=>{b(!1)},ae=async()=>{b(),await xe(),F()},F=()=>{const{maxItems:t}=n.value,l=C.value,e=g.value,s=W.value,o={rect:C.value.getBoundingClientRect()};if(l&&e&&s){const p=t<=h.value.length-1;p&&(s.style.overflowY="auto");const T=p?t:h.value.length-1,_=h.value?h.value[T]:null,$={rect:g.value.getBoundingClientRect()},ue=_?p?_.offsetTop:_.offsetTop+_.offsetHeight:0,ce=o.rect.height+o.rect.top+window.scrollY,U=$.rect.width+o.rect.left,ie=$.rect.width<o.rect.width?o.rect.width:$.rect.width,Y=o.rect.width+o.rect.left-ie,G=document.body.scrollWidth,de=(U>G&&Y<0||U<G)&&n.value.position!=="right"?o.rect.left:Y,P=ue+M;if(e.style.height=`${P}px`,e.style.top=`${ce-M*2}px`,e.style.left=`${de-M}px`,$.rect.width<o.rect.width&&(e.style.minWidth=`${o.rect.width}px`),f.value!==null&&f.value!==""){a.value=r.value.findIndex(ve=>ve[n.value.schema.value]===f.value);const q=h.value[a.value],fe={rect:q.getBoundingClientRect()};s.scrollTop=q.offsetTop+fe.rect.height/2-P/2}}},H=t=>{const{code:l}=t;if(t.preventDefault(),n.value.keyboard&&r.value.length>0){a.value=l==="ArrowDown"?++a.value:--a.value,a.value>=r.value.length?a.value=a.value%r.value.length:a.value<0&&(a.value=r.value.length-1);const e=g.value,s=h.value[a.value],o={rect:g.value.getBoundingClientRect()},p={rect:s.getBoundingClientRect()};a.value!==0&&a.value!==r.value.length-1?l==="ArrowDown"?e.scrollTop+o.rect.height<=s.offsetTop&&(e.scrollTop=e.scrollTop+p.rect.height):e.scrollTop>s.offsetTop&&(e.scrollTop=e.scrollTop-p.rect.height):a.value===0?e.scrollTop=0:e.scrollTop=(r.value.length-n.value.maxItems)*p.rect.height;const T=r.value[a.value];f.value=T[n.value.schema.value],y.value=T[n.value.schema.label]}},se=()=>{const t=N.value;b(!1),t.blur()},re=t=>{const{schema:l}=n.value,e=r.value[t];a.value=t,f.value=e[l.value],y.value=e[l.label],b(!1),z("change",e)},K=t=>{const l=C.value,e=g.value,s=l?!l.contains(t.target):!0,o=e?!e.contains(t.target):!0;s&&o&&b(!1)},V=()=>{oe.value=$e(),F()};return J(()=>f.value,()=>{S()}),J(()=>r.value,()=>{S()},{deep:!0}),pe(()=>{S(),V(),document.addEventListener("click",K,!0),window.addEventListener("resize",V)}),me(()=>{document.removeEventListener("click",K,!0),window.removeEventListener("resize",V)}),(t,l)=>(u(),m(D,null,[w("div",{class:c(["m-form",v.value.main])},[R(Z(ke),{name:d.name,rules:d.rules,modelValue:f.value,"onUpdate:modelValue":l[3]||(l[3]=e=>f.value=e)},{default:B(({field:e,errorMessage:s})=>[w("input",we({type:"hidden",id:d.name},e),null,16,De),w("div",{class:c(["m-form-container flex",v.value.container])},[w("button",{type:"button",class:c(["m-form-element --select grow text-left",[v.value.element,{"--focus":I.value},{"--error":s||n.value.isError}]]),disabled:n.value.isDisabled,ref_key:"elenemtRef",ref:C,onClick:l[0]||(l[0]=o=>ae()),onKeydown:[l[1]||(l[1]=L(o=>H(o),["up"])),l[2]||(l[2]=L(o=>H(o),["down"]))],onKeypress:L(se,["enter"])},[w("div",{class:c(["m-form-type w-full cursor-pointer truncate",[v.value.type,{"--placeholder":!y.value}]]),ref_key:"selectRef",ref:N},[y.value?(u(),m(D,{key:0},[j(A(r.value[a.value][n.value.schema.label]),1)],64)):!y.value&&E.value.value?(u(),m(D,{key:1},[j(A(E.value.value),1)],64)):x("",!0)],2),n.value.arrowType==="caret"?(u(),Q(he,{key:0,icon:"caret_large_down",class:c(["m-form-icon h-[14px] w-[14px] shrink-0 p-[2px] transition-transform duration-300",v.value.icon])},null,8,["class"])):x("",!0),n.value.arrowType==="arrow"?(u(),m("i",Oe)):x("",!0)],42,Ie),t.$slots.suffix?(u(),m("small",{key:0,class:c(["m-form-suffix",v.value.suffix])},[X(t.$slots,"suffix")],2)):x("",!0)],2)]),_:3},8,["name","rules","modelValue"]),R(Z(Te),{as:"span",name:d.name,class:c(["m-form-error",v.value.error])},{default:B(({message:e})=>[R(Ce,{message:e},null,8,["message"])]),_:1},8,["name","class"])],2),(u(),Q(be,{to:"body"},[R(ye,{name:"select-dropdown",onAfterLeave:ne,appear:""},{default:B(()=>[O.value&&r.value&&r.value.length!==0&&!n.value.isDisabled?(u(),m("div",{key:0,class:c(["m-select-dropdown absolute z-[5] mt-[3px] overflow-hidden",v.value.dropdown]),ref_key:"dropdownRef",ref:g},[w("ul",{class:c(["m-select-dropdown-container max-h-full bg-[#fff]",v.value.dropdownContainer]),ref_key:"dropdownContainerRef",ref:W},[(u(!0),m(D,null,ge(r.value,(e,s)=>(u(),m("li",{class:"m-select-dropdown-item",key:`${e}_${s}`,ref_for:!0,ref_key:"dropdownItemRef",ref:h},[w("button",{type:"button",class:c(["m-select-dropdown-button block w-full px-[8px] text-left transition-colors duration-300",{"--active":s===a.value}]),disabled:e[n.value.schema.isDisabled]===!0,onClick:o=>re(s)},[w("em",Se,[X(t.$slots,"option",{item:e},()=>[j(A(e[n.value.schema.label]),1)])])],10,Ee)]))),128))],2)],2)):x("",!0)]),_:3})]))],64))}};export{je as _};
