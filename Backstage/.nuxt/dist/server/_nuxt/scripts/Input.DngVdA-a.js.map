{"version":3,"file":"Input.DngVdA-a.js","sources":["../../../../../components/buy/mForm/Input.vue"],"sourcesContent":["<script setup>\r\nimport SvgIcon from '@components/common/SvgIcon.vue'\r\nimport ErrorMessageElem from '@components/buy/mErrorMessageElem.vue'\r\n\r\nimport { deepMerge, numberComma } from '@js/_prototype.js'\r\n\r\nimport '@js/_validation.js'\r\n// import { userStore } from '@store/user.js'\r\n\r\nimport { computed, nextTick, ref, watch } from 'vue'\r\nimport { Field, ErrorMessage } from 'vee-validate'\r\n\r\n// const user = userStore()\r\nconst emits = defineEmits([\r\n  'update:modelValue',\r\n  'focusin',\r\n  // 'focusout',\r\n  'blur',\r\n  'input',\r\n  'keydown.enter',\r\n])\r\n\r\nconst props = defineProps({\r\n  name: {\r\n    type: String,\r\n    default: null,\r\n  },\r\n  type: {\r\n    type: String,\r\n    default: 'text',\r\n  },\r\n  modelValue: {\r\n    type: [String, Number],\r\n    default: null,\r\n  },\r\n  value: {\r\n    type: [String, Number],\r\n    default: null,\r\n  },\r\n  rules: {\r\n    type: Object,\r\n    default: null,\r\n  },\r\n  config: {\r\n    type: Object,\r\n    default: () => {},\r\n  },\r\n  setClass: {\r\n    type: Object,\r\n    default: () => {},\r\n  },\r\n})\r\n// const isOnComposition = ref(false)\r\nconst model = ref(null)\r\nconst isFocus = ref(false)\r\nconst config = computed(() => {\r\n  return deepMerge(\r\n    {\r\n      placeholder: '',\r\n      length: null,\r\n      minlength: null,\r\n      maxlength: null,\r\n      formatLength: null,\r\n      isReadonly: false,\r\n      isDisabled: false,\r\n      isError: false,\r\n      inputMode: null,\r\n      isExistClose: true, // 輸入後開啟 X 清除\r\n      inputChinese: true, // 開啟關閉輸入中文\r\n      comma: false, // 啟用千分位功能\r\n      checkNotIsZero: false, // 輸入欄位致不能為 0\r\n      integer: false, // 整數功能 (不可使用小數點)\r\n    },\r\n    props.config\r\n  )\r\n})\r\nconst isNumeric = computed(() => config.value.inputMode === 'numeric')\r\nconst formatLength = computed(() => {\r\n  const { formatLength, maxlength } = config.value\r\n\r\n  return formatLength && maxlength\r\n    ? formatLength.replace(/\\{\\s*(length|maxlength)\\s*\\}/g, (_, key) => {\r\n        return key === 'length' ? (model.value ? String(model.value.length) : 0) : String(maxlength)\r\n      })\r\n    : null\r\n})\r\nconst setClass = computed(() => {\r\n  return {\r\n    ...{\r\n      main: '',\r\n      container: '',\r\n      element: '',\r\n      type: '',\r\n      formatLength: '',\r\n      frontAssist: '',\r\n      rearAssist: '',\r\n      suffix: '',\r\n      error: '',\r\n    },\r\n    ...props.setClass,\r\n  }\r\n})\r\nconst onBind = (field) => {\r\n  const { inputMode } = config.value\r\n  const value =\r\n    !props.modelValue && props.value\r\n      ? {\r\n          value: props.value,\r\n        }\r\n      : {}\r\n  const inputmode = isNumeric.value\r\n    ? {\r\n        inputmode: inputMode,\r\n      }\r\n    : {}\r\n\r\n  return {\r\n    ...field,\r\n    ...value,\r\n    ...inputmode,\r\n  }\r\n}\r\n\r\nconst onInput = async (e) => {\r\n  const value = e.target.value\r\n  const { inputMode, checkNotIsZero, integer, inputChinese } = config.value\r\n  const regex = {\r\n    chinese: /[\\u4e00-\\u9fa5０-９Ａ-Ｚａ-ｚ～！＠＃＄％︿＆＊（）＿｜｛｝［］＜＞？／＊＼＋－]/g,\r\n    number: integer ? /[^0-9]/g : /[^0-9.]/g,\r\n  }\r\n\r\n  const isRemoveChinese = (/numeric/.test(inputMode) || !inputChinese) && regex.chinese.test(value)\r\n\r\n  await nextTick()\r\n\r\n  if (isNumeric.value) {\r\n    const number = regex.number.test(value) ? value.replace(regex.number, '') : value\r\n\r\n    model.value =\r\n      (checkNotIsZero && integer && /^0/.test(number)) || (checkNotIsZero && /^0\\d/.test(number))\r\n        ? number.replace(/^0+/, '')\r\n        : number\r\n  } else if (isRemoveChinese) {\r\n    model.value = value.replace(regex.chinese, '')\r\n  }\r\n\r\n  emits('input', e)\r\n}\r\n\r\nconst onEnter = (e) => {\r\n  e.preventDefault()\r\n  emits('keydown.enter')\r\n}\r\n\r\nconst onEvent = (e, errorMessage) => {\r\n  const { comma, checkNotIsZero } = config.value\r\n  const { type } = e\r\n  const isError = !!errorMessage\r\n  const isFocusIn = type === 'focusin'\r\n  const isBlur = type === 'blur'\r\n  const isComma = comma && (model.value !== '' || model.value != null)\r\n\r\n  if (isFocusIn || isBlur) {\r\n    isFocus.value = !isFocus.value\r\n  }\r\n\r\n  if (isFocusIn && isComma) {\r\n    model.value = numberComma.remove(model.value, false)\r\n  }\r\n\r\n  if (isBlur) {\r\n    if (isNumeric.value) {\r\n      model.value =\r\n        checkNotIsZero && /^0\\.$/.test(model.value) ? model.value.replace(/^0\\.$/, '') : model.value\r\n    }\r\n\r\n    const value = isComma ? numberComma.remove(model.value, false) : model.value\r\n\r\n    emits('update:modelValue', value)\r\n\r\n    model.value = isComma ? numberComma.add(model.value, false) : model.value\r\n  }\r\n\r\n  emits(type, e, isError)\r\n}\r\n\r\nconst onWatchModel = (value) => {\r\n  const { comma } = config.value\r\n  const isComma = comma && value !== '' && value != null\r\n\r\n  model.value = isComma ? numberComma.add(value, false) : value\r\n}\r\n\r\nconst onClear = () => {\r\n  model.value = null\r\n}\r\n\r\nwatch(\r\n  () => props.modelValue,\r\n  (value) => {\r\n    onWatchModel(value)\r\n  },\r\n  {\r\n    immediate: true,\r\n  }\r\n)\r\n</script>\r\n\r\n<template>\r\n  <div class=\"m-form overflow-hidden\" :class=\"setClass.main\">\r\n    <Field\r\n      :name=\"props.name\"\r\n      :type=\"props.type\"\r\n      v-model=\"model\"\r\n      :rules=\"props.rules\"\r\n      v-slot=\"{ field, errorMessage }\"\r\n    >\r\n      <div class=\"m-form-container\" :class=\"setClass.container\">\r\n        <div\r\n          class=\"m-form-element\"\r\n          :class=\"[\r\n            setClass.element,\r\n            { '--focus': isFocus },\r\n            { '--readonly': config.isReadonly },\r\n            { '--disabled': config.isDisabled },\r\n            { '--error': errorMessage || config.isError },\r\n          ]\"\r\n        >\r\n          <div\r\n            class=\"m-form-assist shrink-0\"\r\n            :class=\"setClass.frontAssist\"\r\n            v-if=\"$slots.frontAssist\"\r\n          >\r\n            <slot name=\"frontAssist\" />\r\n          </div>\r\n          <input\r\n            :id=\"props.name\"\r\n            :type=\"props.type\"\r\n            class=\"m-form-type min-w-0 grow\"\r\n            :class=\"setClass.type\"\r\n            v-bind=\"onBind(field)\"\r\n            :inputMode=\"config.inputMode\"\r\n            :minlength=\"config.minlength || config.length\"\r\n            :maxlength=\"config.maxlength || config.length\"\r\n            :placeholder=\"config.placeholder\"\r\n            :readonly=\"config.isReadonly\"\r\n            :disabled=\"config.isDisabled\"\r\n            autocomplete=\"off\"\r\n            @focusin=\"onEvent($event)\"\r\n            @blur=\"onEvent($event, errorMessage)\"\r\n            @input=\"onInput($event)\"\r\n            @keydown.enter=\"onEnter($event)\"\r\n          />\r\n          <button\r\n            type=\"button\"\r\n            class=\"m-form-clear-button\"\r\n            :class=\"{\r\n              '--show': model,\r\n            }\"\r\n            @click=\"onClear\"\r\n            v-if=\"config.isExistClose && !config.isDisabled\"\r\n          >\r\n            <SvgIcon icon=\"icon_xmark\" class=\"m-form-clear-icon\" />\r\n          </button>\r\n          <span class=\"m-form-length shrink-0\" :class=\"setClass.length\" v-if=\"formatLength\">\r\n            {{ formatLength }}\r\n          </span>\r\n          <div class=\"m-form-assist shrink-0\" :class=\"setClass.rearAssist\" v-if=\"$slots.rearAssist\">\r\n            <slot name=\"rearAssist\" />\r\n          </div>\r\n        </div>\r\n        <small class=\"m-form-suffix shrink-0\" :class=\"setClass.suffix\" v-if=\"$slots.suffix\">\r\n          <slot\r\n            name=\"suffix\"\r\n            :maxlength=\"config.length || config.maxlength\"\r\n            :length=\"model ? model.length : 0\"\r\n          />\r\n        </small>\r\n      </div>\r\n    </Field>\r\n    <ErrorMessage\r\n      as=\"span\"\r\n      :name=\"props.name\"\r\n      class=\"m-form-error\"\r\n      :class=\"setClass.error\"\r\n      v-slot=\"{ message }\"\r\n    >\r\n      <ErrorMessageElem :message=\"message\" />\r\n    </ErrorMessage>\r\n  </div>\r\n</template>\r\n<style src=\"@css/_modules/buy/mForm.css\"></style>\r\n"],"names":["formatLength","_push","_parent","_ssrRenderClass","$slots","_createVNode","_createBlock","_renderSlot","_mergeProps","_withKeys","SvgIcon","_ssrRenderComponent","ErrorMessageElem"],"mappings":"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"}